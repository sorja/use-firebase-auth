import"firebase/auth";import r from"prop-types";import{useFirebaseApp as e}from"@use-firebase/app";import n,{useState as t,useEffect as i,useMemo as o,useCallback as u,useContext as a}from"react";var s=function(r){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return r.reduce(function(r,n,t){return r+" "+("function"==typeof e[t]?e[t]():e[t]||"")+" "+n},"").split(/[\s,]/).map(function(r){return r.trim()}).filter(function(r){return!!r})},c=function(){for(var r=[],e=arguments.length;e--;)r[e]=arguments[e];var n=Array.isArray(r[0])?s.apply(void 0,r):s([r.join(" ")]);return Object.freeze(n.reduce(function(r,e){var n;return Object.assign({},r,((n={})[e]=e,n))},{}))}("ANONYMOUS","GITHUB","GOOGLE","FACEBOOK","TWITTER","UNKNOWN"),f={anonymous:c.ANONYMOUS,"github.com":c.GITHUB,"google.com":c.GOOGLE,"facebook.com":c.FACEBOOK,"twitter.com":c.TWITTER},d="displayName,email,emailVerified,isAnonymous,phoneNumber,photoURL,uid".split(","),p={};p[c.GITHUB]="GithubAuthProvider",p[c.GOOGLE]="GoogleAuthProvider",p[c.FACEBOOK]="FacebookAuthProvider",p[c.TWITTER]="TwitterAuthProvider";var l=["signInWithRedirect","signInWithPopup"],v={loading:!0},m=function(r){var e=t(v),n=e[0],a=e[1],s=t(null),m=s[0],h=s[1],g=u(function(r){h(r)},[h]),O=o(function(){return r.auth()},[r]),A=u(function(){for(var r=[],e=arguments.length;e--;)r[e]=arguments[e];return h(null),function(r,e,n){void 0===n&&(n={});var t=n.method;if(void 0===t&&(t="signInWithRedirect"),l.includes(t))return e.isOAuthProvider?r[t](e):r.signInAnonymously();throw new Error("Invalid signIn method.")}.apply(void 0,[O].concat(r)).catch(g)},[O,h,g]),b=u(function(){for(var r=[],e=arguments.length;e--;)r[e]=arguments[e];return function(r){return r.signOut()}.apply(void 0,[O].concat(r))},[O]),y=u(function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return function(r,e){var n=p[e];return n?new r.firebase_.auth[n]:{}}.apply(void 0,[r].concat(e))},[r]);return i(function(){return O.onAuthStateChanged(function(r){var e=!!r,n=e?function(r){var e=d.reduce(function(e,n){var t;return Object.assign({},e,((t={})[n]=null===r[n]?void 0:r[n],t))},{});e.authProvider=f[e.isAnonymous?"anonymous":r.providerData[0].providerId]||c.UNKNOWN;var n=r.metadata,t=n.lastSignInTime;return e.creationTime=new Date(n.creationTime),e.lastSignInTime=new Date(t),e.displayName||(e.displayName="USER_"+e.uid.substr(0,6)),e}(r):{};a({isSignedIn:e,user:n,_user:r})})},[O,a]),i(function(){O.getRedirectResult().catch(g)},[O,g]),o(function(){return Object.assign({},n,{signInError:m,app:r,signIn:A,signOut:b,createAuthProvider:y})},[n,m,r,A,b,y])},h=n.createContext(),g=Symbol(),O=function(r){var e=r.children,t=(0,r.useFirebaseApp)(),i=m(t),u=o(function(){return{signature:g,session:i}},[i]);return n.createElement(h.Provider,{value:u},e)};O.propTypes={children:r.element.isRequired,useFirebaseApp:r.func},O.defaultProps={useFirebaseApp:e};var A=function(){var r=a(h)||{},e=r.session;if(r.signature!==g)throw new Error("useFirebaseAuth must be a descendant of <FirebaseAuthProvider/>");return e};export{c as AuthProvider,O as FirebaseAuthProvider,A as useFirebaseAuth};
